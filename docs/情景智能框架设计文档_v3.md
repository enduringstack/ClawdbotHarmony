# æƒ…æ™¯æ™ºèƒ½æ¡†æ¶è®¾è®¡æ–‡æ¡£
> ç‰ˆæœ¬: 4.0
> æ—¥æœŸ: 2026-02-20
> ä½œè€…: æ´ªæ° & Cecilia & Linda

### ä¿®è®¢è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | ä½œè€… | å˜æ›´è¯´æ˜ |
|------|------|------|---------|
| 1.0 | 2026-02-17 | æ´ªæ° & Linda | åˆç‰ˆï¼šæ¦‚è¿°ã€æ•°æ®åˆ†ç±»ã€æ„ŸçŸ¥æ’ä»¶ã€æ„å›¾è¯†åˆ«ã€é‡è¦æ€§è®¡ç®—ã€å¥–åŠ±ç³»ç»Ÿã€å­¦ä¹ ç³»ç»Ÿ |
| 2.0 | 2026-02-19 | æ´ªæ° & Cecilia | ç¼–ç å™¨æ”¹ä¸ºæ¦‚ç‡åˆ†å¸ƒè¾“å‡ºï¼›æ„å›¾è¯†åˆ«é‡å†™ï¼šå¯é…ç½®è§„åˆ™â†’è‡ªåŠ¨ç¼–è¯‘å†³ç­–æ ‘â†’è½¯åŒ¹é…â†’LinUCB(è¯­ä¹‰èåˆ)â†’é²æ£’æ€§5å±‚é˜²æŠ¤ï¼›æ–°å¢æ—¶åºè§„åˆ™ã€ORæ¡ä»¶ã€Cooldownã€å†³ç­–è¿½æº¯ã€æ¨¡æ¿ç»§æ‰¿ã€åŠ¨æ€é˜ˆå€¼ï¼›å¤åˆå¥–åŠ±å‡½æ•° |
| 3.0 | 2026-02-19 | æ´ªæ° & Cecilia | æŒ‰ DDD ä¸ƒæ­¥æ³•é‡æ„å…¨æ–‡ï¼šBoundaryâ†’Use Caseâ†’Sub-domainâ†’Layerâ†’Architectureâ†’Narrow-downâ†’Entityï¼›æ–°å¢ç³»ç»Ÿè¾¹ç•Œå®šä¹‰ã€å››å¤§é—®é¢˜åŸŸåˆ’åˆ†ã€å…­å±‚æ¶æ„æ¨¡å‹ã€æ‰§è¡ŒåŸŸè®¾è®¡ã€å®æ–½è·¯çº¿å›¾ |
| 4.0 | 2026-02-20 | æ´ªæ° & Linda | C++ NAPI è¿ç§»å®æ–½ï¼ˆ4 æ–°æ¨¡å—ï¼‰ï¼›context.test è¿œç¨‹æµ‹è¯•èƒ½åŠ›ï¼›21 åœºæ™¯å…¨è¦†ç›–æµ‹è¯•å¥—ä»¶ï¼›cooldown loadRules ä¿®å¤ï¼›å®é™…ç›®å½•ç»“æ„æ›´æ–° |

---

## ç›®å½•

- [1. Boundary â€” é—®é¢˜è¾¹ç•Œ](#1-boundary--é—®é¢˜è¾¹ç•Œ)
  - [1.1 æƒ…æ™¯æ™ºèƒ½æ˜¯ä»€ä¹ˆ](#11-æƒ…æ™¯æ™ºèƒ½æ˜¯ä»€ä¹ˆ)
  - [1.2 æƒ…æ™¯æ™ºèƒ½ä¸æ˜¯ä»€ä¹ˆ](#12-æƒ…æ™¯æ™ºèƒ½ä¸æ˜¯ä»€ä¹ˆ)
  - [1.3 ç³»ç»Ÿè¾¹ç•Œå›¾](#13-ç³»ç»Ÿè¾¹ç•Œå›¾)
  - [1.4 è¾“å…¥è¾¹ç•Œ](#14-è¾“å…¥è¾¹ç•Œ)
  - [1.5 è¾“å‡ºè¾¹ç•Œ](#15-è¾“å‡ºè¾¹ç•Œ)
  - [1.6 éšç§è¾¹ç•Œ](#16-éšç§è¾¹ç•Œ)
- [2. Use Case â€” åœºæ™¯ä¸ç”¨ä¾‹](#2-use-case--åœºæ™¯ä¸ç”¨ä¾‹)
  - [2.1 ç‰©ç†ä¸–ç•Œæ•°æ®æº](#21-ç‰©ç†ä¸–ç•Œæ•°æ®æº)
  - [2.2 æ•°å­—ä¸–ç•Œæ•°æ®æº](#22-æ•°å­—ä¸–ç•Œæ•°æ®æºæŒ‰é©¬æ–¯æ´›éœ€æ±‚å±‚æ¬¡)
  - [2.3 æ ¸å¿ƒç”¨ä¾‹æ¸…å•](#23-æ ¸å¿ƒç”¨ä¾‹æ¸…å•)
  - [2.4 ç”¨ä¾‹ä¼˜å…ˆçº§](#24-ç”¨ä¾‹ä¼˜å…ˆçº§)
- [3. Sub-domain â€” é—®é¢˜åŸŸåˆ’åˆ†](#3-sub-domain--é—®é¢˜åŸŸåˆ’åˆ†)
  - [3.1 å››å¤§é—®é¢˜åŸŸ](#31-å››å¤§é—®é¢˜åŸŸ)
  - [3.2 æ„ŸçŸ¥åŸŸï¼ˆPerceptionï¼‰](#32-æ„ŸçŸ¥åŸŸperception)
  - [3.3 å†³ç­–åŸŸï¼ˆDecisionï¼‰](#33-å†³ç­–åŸŸdecision)
  - [3.4 æ‰§è¡ŒåŸŸï¼ˆExecutionï¼‰](#34-æ‰§è¡ŒåŸŸexecution)
  - [3.5 å­¦ä¹ åŸŸï¼ˆLearningï¼‰](#35-å­¦ä¹ åŸŸlearning)
  - [3.6 åŸŸé—´äº¤äº’](#36-åŸŸé—´äº¤äº’)
- [4. Layer â€” åˆ†å±‚æ¶æ„](#4-layer--åˆ†å±‚æ¶æ„)
  - [4.1 å…­å±‚æ¨¡å‹](#41-å…­å±‚æ¨¡å‹)
  - [4.2 å„å±‚èŒè´£ä¸è¯­è¨€](#42-å„å±‚èŒè´£ä¸è¯­è¨€)
  - [4.3 å±‚é—´ä¾èµ–è§„åˆ™](#43-å±‚é—´ä¾èµ–è§„åˆ™)
- [5. Architecture â€” æ¶æ„è®¾è®¡](#5-architecture--æ¶æ„è®¾è®¡)
  - [5.1 æ„ŸçŸ¥åŸŸæ¶æ„](#51-æ„ŸçŸ¥åŸŸæ¶æ„)
  - [5.2 å†³ç­–åŸŸæ¶æ„](#52-å†³ç­–åŸŸæ¶æ„)
  - [5.3 æ‰§è¡ŒåŸŸæ¶æ„](#53-æ‰§è¡ŒåŸŸæ¶æ„)
  - [5.4 å­¦ä¹ åŸŸæ¶æ„](#54-å­¦ä¹ åŸŸæ¶æ„)
  - [5.5 æ•°æ®æµå…¨æ™¯](#55-æ•°æ®æµå…¨æ™¯)
- [6. Narrow-down â€” æŠ€æœ¯è¦ç‚¹](#6-narrow-down--æŠ€æœ¯è¦ç‚¹)
  - [6.1 å†³ç­–æ ‘è‡ªåŠ¨ç¼–è¯‘](#61-å†³ç­–æ ‘è‡ªåŠ¨ç¼–è¯‘)
  - [6.2 è½¯åŒ¹é…ç­–ç•¥](#62-è½¯åŒ¹é…ç­–ç•¥)
  - [6.3 LinUCB ç®—æ³•ç»†èŠ‚](#63-linucb-ç®—æ³•ç»†èŠ‚)
  - [6.4 é²æ£’æ€§è¯¦ç»†è®¾è®¡](#64-é²æ£’æ€§è¯¦ç»†è®¾è®¡)
  - [6.5 æ—¶åºè§„åˆ™](#65-æ—¶åºè§„åˆ™)
  - [6.6 Cooldown + åˆå¹¶æ¨é€](#66-cooldown--åˆå¹¶æ¨é€)
  - [6.7 å†·å¯åŠ¨ç­–ç•¥](#67-å†·å¯åŠ¨ç­–ç•¥)
  - [6.8 ç«¯ä¾§è®­ç»ƒæ–¹æ¡ˆ](#68-ç«¯ä¾§è®­ç»ƒæ–¹æ¡ˆ)
- [7. Entity â€” å®ç°è®¾è®¡](#7-entity--å®ç°è®¾è®¡)
  - [7.1 æ ¸å¿ƒæ•°æ®ç»“æ„](#71-æ ¸å¿ƒæ•°æ®ç»“æ„)
  - [7.2 C++ æ¨¡å—è®¾è®¡](#72-c-æ¨¡å—è®¾è®¡)
  - [7.3 NAPI æ¥å£å®šä¹‰](#73-napi-æ¥å£å®šä¹‰)
  - [7.4 ArkTS æœåŠ¡è®¾è®¡](#74-arkts-æœåŠ¡è®¾è®¡)
  - [7.5 å­˜å‚¨è®¾è®¡](#75-å­˜å‚¨è®¾è®¡)
  - [7.6 ç›®å½•ç»“æ„](#76-ç›®å½•ç»“æ„)
  - [7.7 å®æ–½è·¯çº¿å›¾](#77-å®æ–½è·¯çº¿å›¾)
- [8. å®æ–½è®°å½• â€” C++ NAPI è¿ç§»](#8-å®æ–½è®°å½•--c-napi-è¿ç§»)
  - [8.1 è¿ç§»åŸåˆ™](#81-è¿ç§»åŸåˆ™)
  - [8.2 æ–°å¢ C++ æ¨¡å—](#82-æ–°å¢-c-æ¨¡å—)
  - [8.3 ArkTS åŒ…è£…å±‚](#83-arkts-åŒ…è£…å±‚)
  - [8.4 å·²ä¿®å¤é—®é¢˜](#84-å·²ä¿®å¤é—®é¢˜)
  - [8.5 å®é™…ç›®å½•ç»“æ„](#85-å®é™…ç›®å½•ç»“æ„)
- [9. æµ‹è¯•å¥—ä»¶](#9-æµ‹è¯•å¥—ä»¶)
  - [9.1 æµ‹è¯•æ¶æ„](#91-æµ‹è¯•æ¶æ„)
  - [9.2 æµ‹è¯•åœºæ™¯æ¸…å•](#92-æµ‹è¯•åœºæ™¯æ¸…å•)
  - [9.3 æµ‹è¯•ç»“æœ](#93-æµ‹è¯•ç»“æœ)

---

## 1. Boundary â€” é—®é¢˜è¾¹ç•Œ

### 1.1 æƒ…æ™¯æ™ºèƒ½æ˜¯ä»€ä¹ˆ

åœ¨æ‰‹æœºé‡Œæ”¾ä¸€ä¸ª **AI ç§˜ä¹¦**ï¼Œå®ƒèƒ½å¤Ÿï¼š
- **æ„ŸçŸ¥** â€” æ”¶é›†ç‰©ç†ä¸–ç•Œå’Œæ•°å­—ä¸–ç•Œçš„æ•°æ®
- **ç†è§£** â€” çŸ¥é“ç”¨æˆ·çš„éœ€æ±‚å’Œæ„å›¾
- **è¡ŒåŠ¨** â€” åœ¨åˆé€‚çš„æ—¶æœºæä¾›å¸®åŠ©

**æ ¸å¿ƒåŸåˆ™ï¼š**

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **ç‹¬ç«‹äººæ ¼** | AI æ˜¯ä¼™ä¼´ï¼Œä¸æ˜¯é™„å±å“ï¼›æœ‰è‡ªå·±çš„è§‚ç‚¹å’Œè¾¹ç•Œ |
| **éšç§ä¼˜å…ˆ** | ç”¨æˆ·æ§åˆ¶ AI èƒ½çœ‹åˆ°ä»€ä¹ˆï¼Œé»˜è®¤æœ€å°æƒé™ |
| **æœ¬åœ°ä¼˜å…ˆ** | ä¸ªäººæ•°æ®ä¸ç¦»å¼€è®¾å¤‡ï¼Œå­¦ä¹ åœ¨æœ¬åœ°å®Œæˆ |
| **æ¸è¿›æ™ºèƒ½** | ä»è§„åˆ™åˆ°æ¨¡å‹åˆ° LLMï¼ŒæŒ‰éœ€å‡çº§å¤æ‚åº¦ |

### 1.2 æƒ…æ™¯æ™ºèƒ½ä¸æ˜¯ä»€ä¹ˆ

| ä¸æ˜¯ | è¯´æ˜ |
|------|------|
| ä¸æ˜¯é€šç”¨ AI åŠ©æ‰‹ | ä¸å¤„ç†ç”¨æˆ·ä¸»åŠ¨å‘èµ·çš„å¯¹è¯/é—®ç­”ï¼ˆé‚£æ˜¯ ClawdBot ä¸»ä½“çš„äº‹ï¼‰ |
| ä¸æ˜¯é€šçŸ¥ç®¡ç†å™¨ | ä¸åªæ˜¯è¿‡æ»¤/è½¬å‘é€šçŸ¥ï¼Œè€Œæ˜¯ç†è§£åœºæ™¯åä¸»åŠ¨æä¾›æœåŠ¡ |
| ä¸æ˜¯åå°æœåŠ¡ | ä¸æ˜¯æŒç»­è½®è¯¢æ‰€æœ‰æ•°æ®ï¼Œè€Œæ˜¯äº‹ä»¶é©±åŠ¨ + æŒ‰éœ€æŸ¥è¯¢ |
| ä¸æ˜¯äº‘ç«¯ç³»ç»Ÿ | æ ¸å¿ƒå†³ç­–åœ¨æœ¬åœ°å®Œæˆï¼Œäº‘ç«¯åªç”¨äº LLM å…œåº•å’Œæ¨¡å‹ä¸‹å‘ |

### 1.3 ç³»ç»Ÿè¾¹ç•Œå›¾

```plantuml
@startuml
package "ClawdBot App (HarmonyOS)" {
  rectangle "Chat UI\n(ç”¨æˆ·ä¸»åŠ¨å¯¹è¯)\nâ† ç”¨æˆ·å‘æ¶ˆæ¯" as ChatUI
  rectangle "æƒ…æ™¯æ™ºèƒ½å¼•æ“\n(æœ¬æ–‡æ¡£èŒƒå›´)\næ„ŸçŸ¥â†’å†³ç­–â†’æ‰§è¡Œâ†’å­¦ä¹ \nâ† äº‹ä»¶é©±åŠ¨ï¼Œä¸»åŠ¨æœåŠ¡" as ContextAI #LightBlue
  rectangle "OpenClaw Gateway\n(äº‘ç«¯ LLM é€šé“)" as Gateway
  rectangle "HarmonyOS System APIs\n(ä¼ æ„Ÿå™¨/é€šçŸ¥/æ—¥å†/GPS)" as SystemAPI
  
  ChatUI --> Gateway
  ContextAI --> Gateway : LLM å…œåº•
  ContextAI --> SystemAPI : ä¼ æ„Ÿå™¨æ•°æ®
  ChatUI --> SystemAPI
}
@enduml
```

**è¾¹ç•Œå®šä¹‰ï¼š**
- **ä¸ Chat UI çš„è¾¹ç•Œ**ï¼šç”¨æˆ·ä¸»åŠ¨å‘æ¶ˆæ¯ â†’ Chat UI å¤„ç†ï¼›æƒ…æ™¯æ™ºèƒ½ä¸»åŠ¨æ¨é€ â†’ é€šè¿‡é€šçŸ¥/å¡ç‰‡/è¯­éŸ³
- **ä¸ OpenClaw Gateway çš„è¾¹ç•Œ**ï¼šæƒ…æ™¯æ™ºèƒ½åªåœ¨ Layer 3ï¼ˆLLM å…œåº•ï¼‰æ—¶è°ƒç”¨ Gatewayï¼›æ—¥å¸¸å†³ç­–çº¯æœ¬åœ°
- **ä¸ HarmonyOS çš„è¾¹ç•Œ**ï¼šæƒ…æ™¯æ™ºèƒ½é€šè¿‡ç³»ç»Ÿ API è·å–ä¼ æ„Ÿå™¨æ•°æ®ã€å‘é€é€šçŸ¥ï¼›ä¸ä¿®æ”¹ç³»ç»Ÿè¡Œä¸º

### 1.4 è¾“å…¥è¾¹ç•Œ

```
æƒ…æ™¯æ™ºèƒ½æ¥æ”¶çš„è¾“å…¥ï¼š
â”œâ”€â”€ ç‰©ç†ä¸–ç•Œäº‹ä»¶ï¼ˆä¼ æ„Ÿå™¨è§¦å‘ï¼‰
â”‚   â”œâ”€â”€ ä½ç½®å˜åŒ–ï¼ˆGPS/WiFi/è“ç‰™ï¼‰
â”‚   â”œâ”€â”€ è¿åŠ¨çŠ¶æ€å˜åŒ–ï¼ˆåŠ é€Ÿåº¦è®¡ï¼‰
â”‚   â”œâ”€â”€ ç¯å¢ƒå˜åŒ–ï¼ˆå…‰ç…§/å™ªéŸ³/æ¸©åº¦ï¼‰
â”‚   â””â”€â”€ æ‰‹æœºçŠ¶æ€å˜åŒ–ï¼ˆå……ç”µ/ç”µé‡/è¿æ¥ï¼‰
â”‚
â”œâ”€â”€ æ•°å­—ä¸–ç•Œäº‹ä»¶ï¼ˆç³»ç»Ÿé€šçŸ¥ï¼‰
â”‚   â”œâ”€â”€ æ–°æ¶ˆæ¯é€šçŸ¥ï¼ˆIM/é‚®ä»¶/çŸ­ä¿¡ï¼‰
â”‚   â”œâ”€â”€ App é€šçŸ¥ï¼ˆå¤–å–/å¿«é€’/é“¶è¡Œï¼‰
â”‚   â”œâ”€â”€ æ—¥å†äº‹ä»¶æé†’
â”‚   â””â”€â”€ ç³»ç»Ÿäº‹ä»¶ï¼ˆæ¥ç”µ/é—¹é’Ÿï¼‰
â”‚
â””â”€â”€ ç”¨æˆ·åé¦ˆï¼ˆæ˜¾å¼+éšå¼ï¼‰
    â”œâ”€â”€ ç‚¹å‡»/å¿½ç•¥/åˆ’èµ°é€šçŸ¥
    â”œâ”€â”€ è¯´"è°¢è°¢"/"åˆ«çƒ¦æˆ‘"
    â””â”€â”€ ä¸»åŠ¨é…ç½®è§„åˆ™
```

### 1.5 è¾“å‡ºè¾¹ç•Œ

```
æƒ…æ™¯æ™ºèƒ½äº§ç”Ÿçš„è¾“å‡ºï¼š
â”œâ”€â”€ ç”¨æˆ·é€šçŸ¥ï¼ˆä¸»è¦è¾“å‡ºï¼‰
â”‚   â”œâ”€â”€ ç³»ç»Ÿé€šçŸ¥æ ï¼ˆå…¨å±/æ¨ªå¹…/å°çº¢ç‚¹/é™é»˜ï¼‰
â”‚   â”œâ”€â”€ è¯­éŸ³æ’­æŠ¥ï¼ˆå¼€è½¦æ¨¡å¼ï¼‰
â”‚   â”œâ”€â”€ å¡ç‰‡ï¼ˆå¯Œåª’ä½“ä¿¡æ¯ï¼‰
â”‚   â””â”€â”€ åˆå¹¶æ‘˜è¦ï¼ˆæ‰¹é‡ä¿¡æ¯æ±‡æ€»ï¼‰
â”‚
â”œâ”€â”€ é™é»˜åŠ¨ä½œï¼ˆä¸æ‰“æ‰°ç”¨æˆ·ï¼‰
â”‚   â”œâ”€â”€ é¢„ç¼“å­˜æ•°æ®ï¼ˆæå‰åŠ è½½å¤©æ°”/è·¯å†µï¼‰
â”‚   â”œâ”€â”€ è°ƒæ•´ç³»ç»Ÿè®¾ç½®ï¼ˆé™éŸ³/äº®åº¦ï¼‰
â”‚   â””â”€â”€ åå°å‡†å¤‡ï¼ˆæ•´ç†æ—¥ç¨‹æ‘˜è¦ï¼‰
â”‚
â””â”€â”€ åé¦ˆç»™å­¦ä¹ ç³»ç»Ÿ
    â”œâ”€â”€ å†³ç­–è¿½æº¯è®°å½•
    â””â”€â”€ å¥–åŠ±ä¿¡å·ï¼ˆç»™ LinUCBï¼‰
```

### 1.6 éšç§è¾¹ç•Œ

| çº§åˆ« | ç¬¦å· | AI å¯è§å†…å®¹ | è¯´æ˜ |
|------|------|-----------|------|
| **å¼€æ”¾** | ğŸŸ¢ | å®Œæ•´åŸæ–‡ | AI å®Œå…¨å¯è§ |
| **æ‘˜è¦** | ğŸŸ¡ | æ‘˜è¦+å…ƒæ•°æ® | AI åªçœ‹æ¦‚è¦ï¼Œä¸çœ‹åŸæ–‡ |
| **ç¦æ­¢** | ğŸ”´ | ä»…"æœ‰æ–°æ¶ˆæ¯" | AI å®Œå…¨ä¸å¯è§ |
| **æˆæƒ** | ğŸ”µ | ä¸´æ—¶å®Œæ•´è®¿é—® | ç”¨æˆ·æˆæƒåå¯è§ï¼Œç”¨å®Œæ’¤é”€ |

**éšç§åŸåˆ™ï¼š**
1. é»˜è®¤æœ€å°æƒé™ï¼ˆæ–°æ•°æ®æºé»˜è®¤ ğŸ”´ï¼‰
2. ç”¨æˆ·ä¸»åŠ¨æˆæƒ
3. ä¸´æ—¶æˆæƒè‡ªåŠ¨æ’¤é”€
4. æ‘˜è¦çº§åˆ«åªç»™ç»Ÿè®¡ï¼Œä¸ç»™åŸæ–‡
5. å®¡è®¡æ—¥å¿—å¯æŸ¥

---

## 2. Use Case â€” åœºæ™¯ä¸ç”¨ä¾‹

### 2.1 ç‰©ç†ä¸–ç•Œæ•°æ®æº

#### ğŸ‘¤ äºº (Human)

| å­ç±» | æ•°æ® | æ¥æº |
|------|------|------|
| **ç”Ÿå‘½ä½“å¾** | å¿ƒç‡ã€HRVã€è¡€å‹ã€è¡€æ°§ã€ä½“æ¸© | æ‰‹è¡¨/æ‰‹ç¯ |
| **è¿åŠ¨çŠ¶æ€** | é™æ­¢(å/ç«™/èºº)ã€èµ°è·¯ã€è·‘æ­¥ã€éª‘è½¦ã€åè½¦ | åŠ é€Ÿåº¦è®¡ |
| **èº«ä½“å±æ€§** | èº«é«˜ã€ä½“é‡ã€ä½“è„‚ã€å¹´é¾„ã€æ€§åˆ« | ç”¨æˆ·æ¡£æ¡ˆ |
| **ç²¾ç¥çŠ¶æ€** | ç¡çœ è´¨é‡ã€ç–²åŠ³åº¦ã€å‹åŠ›ã€æƒ…ç»ª | æ¨æ–­/è‡ªæŠ¥ |
| **ç”Ÿç‰©ç‰¹å¾** | å£°çº¹ã€é¢éƒ¨ã€æŒ‡çº¹ | ä¼ æ„Ÿå™¨ |

#### ğŸ“± æ‰‹æœº (Phone)

| å­ç±» | æ•°æ® |
|------|------|
| **å§¿æ€** | æ¡æŒæ–¹å¼ã€å±å¹•æœå‘ |
| **ä½ç½®** | GPSåæ ‡ã€åœ°ç‚¹ç±»å‹(å®¶/å…¬å¸/å•†åœº) |
| **ç”µæº** | ç”µé‡ã€å……ç”µçŠ¶æ€ |
| **è¿æ¥** | WiFiã€è“ç‰™ã€ä¿¡å·å¼ºåº¦ |
| **æ—¶é—´** | æ—¶åˆ»ã€æ˜ŸæœŸã€èŠ‚å‡æ—¥ |

#### ğŸŒ³ ç¯å¢ƒ (äº”æ„Ÿ)

| æ„Ÿå®˜ | æ•°æ® | æ¥æº |
|------|------|------|
| ğŸ‘ï¸ **çœ¼** | å…‰ç…§ã€åœºæ™¯ã€äººç‰©ã€ç‰©ä½“ | æ‘„åƒå¤´/å…‰çº¿ä¼ æ„Ÿå™¨ |
| ğŸ‘‚ **è€³** | å™ªéŸ³çº§åˆ«ã€ç¯å¢ƒéŸ³ç±»å‹ã€è¯­éŸ³ | éº¦å…‹é£ |
| ğŸ‘ƒ **é¼»** | ç©ºæ°”è´¨é‡ã€PM2.5 | ä¼ æ„Ÿå™¨/API |
| ğŸ‘… **èˆŒ** | (é—´æ¥æ¨æ–­) | åœºæ™¯+æ—¶é—´ |
| ğŸ–ï¸ **èº«** | æ¸©åº¦ã€æ¹¿åº¦ã€æ°”å‹ | ç¯å¢ƒä¼ æ„Ÿå™¨ |

### 2.2 æ•°å­—ä¸–ç•Œæ•°æ®æºï¼ˆæŒ‰é©¬æ–¯æ´›éœ€æ±‚å±‚æ¬¡ï¼‰

| å±‚çº§ | æ•°æ® | éšç§ | æ¥æº |
|------|------|------|------|
| **1ï¸âƒ£ ç”Ÿç†** | å¤–å–/é£Ÿå“è®¢å• | ğŸŸ¢ | ç¾å›¢/é¥¿äº†ä¹ˆ |
| | å¥åº·æ•°æ®è¶‹åŠ¿ | ğŸŸ¡ | å¥åº·app |
| | åŒ»ç–—è¯Šæ–­è®°å½• | ğŸ”´ | åŒ»ç–—app |
| **2ï¸âƒ£ å®‰å…¨** | å¿«é€’/å‡ºè¡ŒçŠ¶æ€ | ğŸŸ¢ | å¿«é€’/å‡ºè¡Œapp |
| | è´¦å•æé†’ | ğŸŸ¡ | é“¶è¡Œapp |
| | è´¢åŠ¡æ˜ç»†/å¯†ç  | ğŸ”´ | é‡‘èapp |
| **3ï¸âƒ£ ç¤¾äº¤** | å…¬å¼€ç¾¤èŠ | ğŸŸ¢ | ç¤¾äº¤app |
| | ç§èŠæ¶ˆæ¯æ‘˜è¦ | ğŸŸ¡ | IM app |
| | ç§å¯†å¯¹è¯å†…å®¹ | ğŸ”´ | IM app |
| **4ï¸âƒ£ å°Šé‡** | ä»»åŠ¡/æ—¥ç¨‹ | ğŸŸ¢ | æ—¥å†/ä»»åŠ¡app |
| | å·¥ä½œæ–‡æ¡£æ ‡é¢˜ | ğŸŸ¡ | åŠå…¬app |
| | è–ªèµ„/ç»©æ•ˆ | ğŸ”´ | HRç³»ç»Ÿ |
| **5ï¸âƒ£ è‡ªæˆ‘å®ç°** | å…¬å¼€å­¦ä¹ å†…å®¹ | ğŸŸ¢ | å­¦ä¹ å¹³å° |
| | å­¦ä¹ è¿›åº¦ | ğŸŸ¡ | å­¦ä¹ app |
| | ç§äººæ—¥è®° | ğŸ”´ | ç¬”è®°app |

### 2.3 æ ¸å¿ƒç”¨ä¾‹æ¸…å•

| ç”¨ä¾‹ | è§¦å‘æ¡ä»¶ | åŠ¨ä½œ | ä¼˜å…ˆçº§ |
|------|---------|------|--------|
| ğŸš— é€šå‹¤æé†’ | å·¥ä½œæ—¥ + 7:00Â±30min + åœ¨å®¶ | æ¨è·¯å†µ+å¤©æ°” | ğŸŸ¡ |
| ğŸœ åˆé¤æ¨è | å·¥ä½œæ—¥ + 12:00Â±1h + åœ¨å…¬å¸ | æ¨é™„è¿‘é¤å…/å¤–å– | ğŸŸ¢ |
| ğŸ“± é‡è¦æ¶ˆæ¯ | è€å©†/è€æ¿å‘æ¶ˆæ¯ | ç´§æ€¥é€šçŸ¥ | ğŸ”´ |
| ğŸ”‹ ä½ç”µé‡ | ç”µé‡<20% + æœªå……ç”µ | æé†’å……ç”µ | ğŸŸ¡ |
| ğŸŒ™ ç¡å‰æ‘˜è¦ | 22:00-24:00 + åœ¨å®¶ | æ˜æ—¥æ—¥ç¨‹+å¤©æ°” | ğŸŸ¢ |
| ğŸ“¦ å¿«é€’åˆ°è¾¾ | å¿«é€’é€šçŸ¥ + åœ¨å®¶ | æé†’å–ä»¶ | ğŸŸ¢ |
| ğŸƒ è¿åŠ¨æé†’ | ä¹…å>2å°æ—¶ | å»ºè®®æ´»åŠ¨ | ğŸŸ¢ |
| ğŸ“§ æ¶ˆæ¯å †ç§¯ | 10minå†…3+æ¡æœªè¯» | åˆå¹¶æé†’ | ğŸŸ¡ |
| ğŸš— å›å®¶è·¯å†µ | ç¦»å¼€å…¬å¸+ä¸Šè½¦ | æ’­æŠ¥è·¯å†µ | ğŸŸ¡ |
| ğŸ˜´ ç¡çœ å»ºè®® | è¿ç»­3å¤©23ç‚¹åè¿˜åœ¨ç”¨æ‰‹æœº | å»ºè®®æ—©ç¡ | ğŸŸ¢ |
| ğŸ“… ä¼šè®®å‡†å¤‡ | æ—¥å†äº‹ä»¶å‰15min | æé†’+ææ–™ | ğŸŸ¡ |
| ğŸ”‡ è‡ªåŠ¨é™éŸ³ | è¿›å…¥ä¼šè®®å®¤/ç”µå½±é™¢ | é™éŸ³æ‰‹æœº | âšª |

### 2.4 ç”¨ä¾‹ä¼˜å…ˆçº§

| é˜¶æ®µ | ç”¨ä¾‹ | åŸå›  |
|------|------|------|
| **MVP** | é€šå‹¤æé†’ã€é‡è¦æ¶ˆæ¯ã€ä½ç”µé‡ã€ç¡å‰æ‘˜è¦ | è§¦å‘æ¡ä»¶ç®€å•ï¼Œä»·å€¼é«˜ |
| **Phase 2** | åˆé¤æ¨èã€æ¶ˆæ¯å †ç§¯ã€ä¼šè®®å‡†å¤‡ã€å¿«é€’åˆ°è¾¾ | éœ€è¦é€šçŸ¥æ‹¦æˆª |
| **Phase 3** | è¿åŠ¨æé†’ã€ç¡çœ å»ºè®®ã€è‡ªåŠ¨é™éŸ³ã€å›å®¶è·¯å†µ | éœ€è¦æŒç»­ä¼ æ„Ÿå™¨+æ—¶åº |

---

## 3. Sub-domain â€” é—®é¢˜åŸŸåˆ’åˆ†

### 3.1 å››å¤§é—®é¢˜åŸŸ

```plantuml
@startuml
skinparam rectangle {
  RoundCorner 10
}

package "æƒ…æ™¯æ™ºèƒ½ç³»ç»Ÿ" {
  rectangle "æ„ŸçŸ¥åŸŸ\nPerception" as P #LightGreen
  rectangle "å†³ç­–åŸŸ\nDecision" as D #LightBlue
  rectangle "æ‰§è¡ŒåŸŸ\nExecution" as E #LightYellow
  rectangle "å­¦ä¹ åŸŸ\nLearning" as L #LightPink
  
  P -right-> D : EncodedEvent
  D -right-> E : Decision
  E -right-> L : Feedback
  L -left-> P : åé¦ˆå¾ªç¯
  L -up-> D : æ›´æ–°å‚æ•°
}
@enduml
```

### 3.2 æ„ŸçŸ¥åŸŸï¼ˆPerceptionï¼‰

**èŒè´£ï¼š** æ”¶é›†åŸå§‹æ•°æ®ï¼Œç¼–ç ä¸ºç»“æ„åŒ–çš„æ¦‚ç‡åˆ†å¸ƒäº‹ä»¶

```
è¾“å…¥ï¼šä¼ æ„Ÿå™¨åŸå§‹æ•°æ® / ç³»ç»Ÿé€šçŸ¥ / API æ•°æ®
è¾“å‡ºï¼šEncodedEventï¼ˆæ¦‚ç‡åˆ†å¸ƒ + ç‰¹å¾å‘é‡ + æ•°æ®è´¨é‡ï¼‰

å­æ¨¡å—ï¼š
â”œâ”€â”€ æ’ä»¶æ³¨å†Œï¼ˆç±»åˆ«/åˆ†ç±»å™¨/ç¼–ç å™¨ä¸‰è¦ç´ ï¼‰
â”œâ”€â”€ ç‰©ç†ä¸–ç•Œç¼–ç å™¨ï¼ˆä½ç½®/è¿åŠ¨/ç¯å¢ƒ â†’ æ¦‚ç‡åˆ†å¸ƒï¼‰
â”œâ”€â”€ æ•°å­—ä¸–ç•Œç¼–ç å™¨ï¼ˆé€šçŸ¥/æ—¥å†/æ¶ˆæ¯ â†’ æ¦‚ç‡åˆ†å¸ƒï¼‰
â””â”€â”€ æ„ŸçŸ¥æ€»çº¿ï¼ˆäº‹ä»¶è·¯ç”± + éšç§é¢„è¿‡æ»¤ï¼‰
```

**æ ¸å¿ƒæ¥å£ï¼š** æ¦‚ç‡åˆ†å¸ƒè¾“å‡ºï¼ˆmulti-labelï¼Œä¸è¦æ±‚å½’ä¸€åŒ–ï¼‰+ æ•°æ®è´¨é‡è¯„åˆ†

### 3.3 å†³ç­–åŸŸï¼ˆDecisionï¼‰

**èŒè´£ï¼š** æ ¹æ®å½“å‰åœºæ™¯ï¼Œå†³å®šåšä»€ä¹ˆ

```
è¾“å…¥ï¼šEncodedEvent + ç”¨æˆ·ä¸Šä¸‹æ–‡
è¾“å‡ºï¼šDecisionï¼ˆæ„å›¾ + ç½®ä¿¡åº¦ + åŠ¨ä½œç±»å‹ + å†³ç­–è¿½æº¯ï¼‰

å­æ¨¡å—ï¼š
â”œâ”€â”€ è§„åˆ™é…ç½®ï¼ˆç”¨æˆ·å¹³é“ºç¼–å†™è§„åˆ™ï¼‰
â”œâ”€â”€ å†³ç­–æ ‘ç¼–è¯‘å™¨ï¼ˆè‡ªåŠ¨ç¼–è¯‘ + æˆæœ¬æ„ŸçŸ¥æ’åºï¼‰
â”œâ”€â”€ è½¯åŒ¹é…å¼•æ“ï¼ˆæ¦‚ç‡åˆ†å¸ƒ â†’ å¤šå¶èŠ‚ç‚¹ç½®ä¿¡åº¦ï¼‰
â”œâ”€â”€ LinUCB ç­–ç•¥ï¼ˆè¯­ä¹‰èåˆ + åŠ¨ä½œé€‰æ‹©ï¼‰
â”œâ”€â”€ LLM å…œåº•ï¼ˆå†³ç­–æ ‘æœªè¦†ç›–çš„åœºæ™¯ï¼‰
â”œâ”€â”€ Cooldown ç®¡ç†
â”œâ”€â”€ æ—¶åºè§„åˆ™å¼•æ“ï¼ˆäº‹ä»¶åºåˆ—åŒ¹é…ï¼‰
â””â”€â”€ å†³ç­–è¿½æº¯è®°å½•
```

**æ ¸å¿ƒç®—æ³•ï¼š** å†³ç­–æ ‘ï¼ˆè½¯åŒ¹é…ï¼‰+ LinUCBï¼ˆè¯­ä¹‰èåˆ + æ—¶é—´è¡°å‡ï¼‰

### 3.4 æ‰§è¡ŒåŸŸï¼ˆExecutionï¼‰

**èŒè´£ï¼š** å°†å†³ç­–è½¬åŒ–ä¸ºå…·ä½“çš„ç”¨æˆ·å¯è§åŠ¨ä½œ

```
è¾“å…¥ï¼šDecision
è¾“å‡ºï¼šç”¨æˆ·é€šçŸ¥ / è¯­éŸ³æ’­æŠ¥ / é™é»˜åŠ¨ä½œ

å­æ¨¡å—ï¼š
â”œâ”€â”€ éšç§è¿‡æ»¤ï¼ˆæ‰§è¡Œå‰æœ€åä¸€é“å…³ï¼‰
â”œâ”€â”€ å†…å®¹ç”Ÿæˆï¼ˆæ¨¡æ¿å¡«å…… / APIæ‹¼è£… / LLMç”Ÿæˆï¼‰
â”œâ”€â”€ å½¢å¼é€‰æ‹©ï¼ˆå…¨å±/æ¨ªå¹…/å°çº¢ç‚¹/è¯­éŸ³/é™é»˜ï¼‰
â”œâ”€â”€ æ—¶æœºè°ƒåº¦ï¼ˆç«‹å³/ç­‰è§£é”/ç­‰ç©ºé—²/åˆå¹¶ï¼‰
â”œâ”€â”€ å¤šæ¨¡æ€è¾“å‡ºï¼ˆæ–‡å­—/å¡ç‰‡/è¯­éŸ³/å¿«æ·æ“ä½œï¼‰
â””â”€â”€ åé¦ˆé‡‡é›†è§¦å‘
```

**æ ¸å¿ƒç­–ç•¥ï¼š** ç´§æ€¥åº¦ Ã— ç”¨æˆ·çŠ¶æ€ â†’ æ¨é€å½¢å¼çŸ©é˜µ

### 3.5 å­¦ä¹ åŸŸï¼ˆLearningï¼‰

**èŒè´£ï¼š** ä»ç”¨æˆ·åé¦ˆä¸­æŒç»­æ”¹è¿›å†³ç­–è´¨é‡

```
è¾“å…¥ï¼šç”¨æˆ·åé¦ˆï¼ˆæ˜¾å¼+éšå¼ï¼‰
è¾“å‡ºï¼šæ›´æ–°åçš„ LinUCB å‚æ•°

å­æ¨¡å—ï¼š
â”œâ”€â”€ åé¦ˆé‡‡é›†ï¼ˆç‚¹å‡»/å¿½ç•¥/åˆ’èµ°/è°¢è°¢/åˆ«çƒ¦æˆ‘ï¼‰
â”œâ”€â”€ å¥–åŠ±è®¡ç®—ï¼ˆåŸºç¡€åé¦ˆ + æ‰“æ‰°æƒ©ç½š + æ­£ç¡®æ€§ï¼‰
â”œâ”€â”€ å¼‚å¸¸æ£€æµ‹ï¼ˆè¿‡æ»¤ååé¦ˆï¼‰
â”œâ”€â”€ LinUCB åœ¨çº¿æ›´æ–°ï¼ˆæ—¶é—´è¡°å‡ï¼‰
â”œâ”€â”€ æ£€æŸ¥ç‚¹ç®¡ç†ï¼ˆè‡ªåŠ¨å¿«ç…§ + å›æ»šï¼‰
â””â”€â”€ æ€§èƒ½ç›‘æ§ï¼ˆæ»‘åŠ¨çª—å£å¹³å‡å¥–åŠ±ï¼‰
```

**æ ¸å¿ƒæœºåˆ¶ï¼š** 5å±‚é²æ£’æ€§é˜²æŠ¤ + æ—¶é—´è¡°å‡é—å¿˜

### 3.6 åŸŸé—´äº¤äº’

```plantuml
@startuml
rectangle "æ„ŸçŸ¥åŸŸ" as P #LightGreen
rectangle "å†³ç­–åŸŸ" as D #LightBlue
rectangle "æ‰§è¡ŒåŸŸ" as E #LightYellow
rectangle "å­¦ä¹ åŸŸ" as L #LightPink
actor ç”¨æˆ· as U

P -right-> D : EncodedEvent
D -right-> E : Decision
E -right-> U : Action (é€šçŸ¥/è¯­éŸ³)
U -down-> L : Feedback
L -left-> D : UpdatedParams (LinUCB)
@enduml
```

**æ•°æ®æ ¼å¼çº¦å®šï¼š**
- æ„ŸçŸ¥â†’å†³ç­–ï¼š`EncodedEvent`ï¼ˆæ¦‚ç‡åˆ†å¸ƒ + ç‰¹å¾ + qualityï¼‰
- å†³ç­–â†’æ‰§è¡Œï¼š`Decision`ï¼ˆæ„å›¾ + ç½®ä¿¡åº¦ + åŠ¨ä½œ + è¿½æº¯ï¼‰
- æ‰§è¡Œâ†’å­¦ä¹ ï¼š`Feedback`ï¼ˆåŠ¨ä½œID + ç”¨æˆ·å“åº” + å»¶è¿Ÿï¼‰
- å­¦ä¹ â†’å†³ç­–ï¼šç›´æ¥æ›´æ–° LinUCB å†…éƒ¨å‚æ•°ï¼ˆA, b çŸ©é˜µï¼‰

---

## 4. Layer â€” åˆ†å±‚æ¶æ„

### 4.1 å…­å±‚æ¨¡å‹

```plantuml
@startuml
skinparam component {
  BackgroundColor<<ui>> #DCEEFB
  BackgroundColor<<biz>> #D5E8D4
  BackgroundColor<<napi>> #FFF2CC
  BackgroundColor<<engine>> #F8CECC
  BackgroundColor<<os>> #E1D5E7
  BackgroundColor<<ext>> #F5F5F5
}

rectangle "Layer 6: ArkTS UI å±‚\nè§„åˆ™é…ç½® / å†³ç­–è¿½æº¯ / å­¦ä¹ è®¾ç½® / é€šçŸ¥å¡ç‰‡" <<ui>> as L6
rectangle "Layer 5: ArkTS ä¸šåŠ¡å±‚\nåŠ¨ä½œæ‰§è¡Œ / å†…å®¹ç”Ÿæˆ / æ—¶æœºè°ƒåº¦ / æ’ä»¶ç®¡ç† / åé¦ˆé‡‡é›†" <<biz>> as L5
rectangle "Layer 4: C++ NAPI æ¡¥æ¥å±‚\nJSON åºåˆ—åŒ– / ç±»å‹è½¬æ¢ / å¼‚æ­¥è°ƒç”¨å°è£…" <<napi>> as L4
rectangle "Layer 3: C++ å¼•æ“å±‚\nå†³ç­–æ ‘ / è½¯åŒ¹é… / LinUCB / äº‹ä»¶ç¼“å†² / Cooldown / è¿½æº¯" <<engine>> as L3
rectangle "Layer 2: HarmonyOS ç³»ç»Ÿå±‚\nä¼ æ„Ÿå™¨API / é€šçŸ¥æ‹¦æˆª / æ—¥å†API / GPS / è“ç‰™ / WiFi" <<os>> as L2
rectangle "Layer 1: å¤–éƒ¨æœåŠ¡å±‚\nOpenClaw Gateway(LLM) / å¤©æ°”API / åœ°å›¾API" <<ext>> as L1

L6 -down-> L5
L5 -down-> L4
L4 -down-> L3
L3 -down-> L2
L5 -down-> L2 : ç³»ç»ŸAPIè°ƒç”¨
L5 -down-> L1 : HTTP
@enduml
```

### 4.2 å„å±‚èŒè´£ä¸è¯­è¨€

| å±‚ | èŒè´£ | è¯­è¨€ | åŸå›  |
|----|------|------|------|
| UI å±‚ | ç”¨æˆ·äº¤äº’ç•Œé¢ | ArkTS | HarmonyOS UI å¿…é¡»ç”¨ ArkTS |
| ä¸šåŠ¡å±‚ | æ‰§è¡ŒåŸŸé€»è¾‘ | ArkTS | éœ€è°ƒç³»ç»Ÿ APIã€UI æ¸²æŸ“ |
| NAPI æ¡¥æ¥ | ArkTS â†” C++ | C++ | N-API æ ‡å‡† |
| å¼•æ“å±‚ | å†³ç­–åŸŸ+å­¦ä¹ åŸŸæ ¸å¿ƒ | C++ | æ€§èƒ½ã€å†…å­˜æ§åˆ¶ã€è·¨å¹³å° |
| ç³»ç»Ÿå±‚ | æ„ŸçŸ¥åŸŸæ•°æ®æº | ArkTSâ†’C++ | ç³»ç»Ÿ API ç”¨ ArkTSï¼Œç¼–ç ç”¨ C++ |
| å¤–éƒ¨æœåŠ¡ | LLM/API | HTTP | ç½‘ç»œè°ƒç”¨ |

### 4.3 å±‚é—´ä¾èµ–è§„åˆ™

```
ä¸Šå±‚å¯ä»¥è°ƒç”¨ä¸‹å±‚ âœ…
ä¸‹å±‚ä¸èƒ½è°ƒç”¨ä¸Šå±‚ âŒï¼ˆé€šè¿‡å›è°ƒ/äº‹ä»¶é€šçŸ¥ï¼‰
åŒå±‚ä¹‹é—´é€šè¿‡æ¥å£é€šä¿¡ âœ…
è·¨å±‚è°ƒç”¨ç¦æ­¢ï¼ˆå¿…é¡»ç»è¿‡ç›¸é‚»å±‚ï¼‰âŒ
```

---

## 5. Architecture â€” æ¶æ„è®¾è®¡

### 5.1 æ„ŸçŸ¥åŸŸæ¶æ„

#### æ’ä»¶æ³¨å†Œä¸‰è¦ç´ 

```plantuml
@startuml
skinparam rectangle {
  RoundCorner 10
}

rectangle "æ„ŸçŸ¥æ’ä»¶" {
  rectangle "1ï¸âƒ£ ç±»åˆ«æ³¨å†Œ (Category)\nÂ· ç‰©ç†/æ•°å­—ä¸–ç•Œ\nÂ· åŸŸ/å­åŸŸ\nÂ· é»˜è®¤éšç§çº§åˆ«" as Cat #LightGreen
  rectangle "2ï¸âƒ£ åˆ†ç±»å™¨ (Classifier)\nÂ· å°æ¨¡å‹ or è§„åˆ™å‡½æ•°\nÂ· è¾“å…¥ï¼šåŸå§‹æ•°æ®\nÂ· è¾“å‡ºï¼šåˆ†ç±»æ ‡ç­¾ + ç½®ä¿¡åº¦" as Cls #LightBlue
  rectangle "3ï¸âƒ£ ç¼–ç å™¨ (Encoder)\nÂ· è¾“å‡ºæ¦‚ç‡åˆ†å¸ƒï¼ˆmulti-labelï¼‰\nÂ· è¾“å‡ºç‰¹å¾å‘é‡ï¼ˆç»™LinUCBç”¨ï¼‰\nÂ· è¾“å‡ºæ‘˜è¦ï¼ˆç»™LLMç”¨ï¼‰\nÂ· è¾“å‡ºæ•°æ®è´¨é‡è¯„åˆ†" as Enc #LightYellow
  
  Cat -down-> Cls
  Cls -down-> Enc
}
@enduml
```

#### ç¼–ç å™¨è¾“å‡ºè§„èŒƒ

```typescript
interface EncodedOutput {
  distribution: Map<string, number>;  // æ¦‚ç‡åˆ†å¸ƒï¼ˆä¸è¦æ±‚å½’ä¸€åŒ–ï¼‰
  features: number[];                 // ç‰¹å¾å‘é‡
  summary?: string;                   // æ–‡æœ¬æ‘˜è¦
  quality: number;                    // æ•°æ®è´¨é‡ 0~1
}
```

#### å„æ’ä»¶åˆ†å¸ƒè¾“å‡ºç¤ºä¾‹

| æ’ä»¶ | åˆ†å¸ƒè¾“å‡º | è¯´æ˜ |
|------|---------|------|
| ä½ç½® | `{home:0.8, market:0.7, office:0.02}` | GPS ç²¾åº¦å·®æ—¶å¤šåœ°ç‚¹æœ‰æ¦‚ç‡ |
| è¿åŠ¨ | `{still:0.6, walking:0.3, driving:0.1}` | ç­‰çº¢ç¯æ—¶é™æ­¢å’Œå¼€è½¦éƒ½å¯èƒ½ |
| æ—¶é—´æ®µ | `{morning:0.9, commute:0.7}` | éäº’æ–¥åˆ†ç±» |
| å™ªéŸ³ | `{quiet:0.4, office:0.5, cafe:0.3}` | ç¯å¢ƒéŸ³ä¸ç¡®å®š |

### 5.2 å†³ç­–åŸŸæ¶æ„

#### æ•´ä½“æµç¨‹

```plantuml
@startuml
start
:ç”¨æˆ·è§„åˆ™ï¼ˆå¹³é“ºï¼‰;
:compile();
:å†³ç­–æ ‘ï¼ˆè‡ªåŠ¨ç¼–è¯‘ï¼Œæˆæœ¬æ„ŸçŸ¥æ’åºï¼‰;
:evaluateSoft();
:å¤šå¶èŠ‚ç‚¹ + ç½®ä¿¡åº¦;
:è¯­ä¹‰èåˆ;
:State å‘é‡\n[åŸå§‹ç‰¹å¾, åœºæ™¯è¯­ä¹‰, å†å²];
:LinUCB é€‰æ‹©åŠ¨ä½œ;
if (ç½®ä¿¡åº¦è¶³å¤Ÿ?) then (æ˜¯)
  :è¾“å‡º Decision;
else (å¦)
  :fallback åˆ° LLM;
endif
stop
@enduml
```

#### è§„åˆ™é…ç½®

ç”¨æˆ·å¹³é“ºå†™è§„åˆ™ï¼Œç³»ç»Ÿè‡ªåŠ¨ç¼–è¯‘ä¸ºå†³ç­–æ ‘ï¼š

```typescript
interface SmartRule {
  id: string;
  name: string;
  enabled: boolean;
  conditions: Map<string, RuleCondition>;       // AND å…³ç³»
  conditionGroups?: Map<string, RuleCondition>[]; // OR ç»„ï¼ˆå¯é€‰ï¼‰
  temporal?: TemporalCondition;                 // æ—¶åºæ¡ä»¶ï¼ˆå¯é€‰ï¼‰
  extends?: string[];                           // æ¨¡æ¿ç»§æ‰¿ï¼ˆå¯é€‰ï¼‰
  intent: string;
  priority: 'ğŸ”´' | 'ğŸŸ¡' | 'ğŸŸ¢' | 'âšª';
  action: string;
  cooldown?: CooldownConfig;
}
```

#### å†³ç­–æ ‘è‡ªåŠ¨ç¼–è¯‘

- æŒ‰ key è‡ªåŠ¨å»ºæ ‘ï¼Œç›¸åŒ key åˆå¹¶
- æˆæœ¬æ„ŸçŸ¥æ’åºï¼šä¾¿å®œçš„åˆ¤æ–­ï¼ˆæ—¶é—´ã€æ˜ŸæœŸï¼‰æ”¾ä¸Šå±‚ï¼Œè´µçš„ï¼ˆGPSã€ä¼ æ„Ÿå™¨ï¼‰æ”¾ä¸‹å±‚
- è§„åˆ™å˜æ›´æ—¶è‡ªåŠ¨é‡æ–°ç¼–è¯‘

#### è½¯åŒ¹é…

- æ¯ä¸ªæ¡ä»¶è¿”å› 0~1 ç½®ä¿¡åº¦ï¼ˆä¸æ˜¯ booleanï¼‰
- ç¼ºå¤±æ•°æ® = 0.5ï¼ˆä¸çŸ¥é“ â‰  ä¸åŒ¹é…ï¼‰
- ä½ç½®ç­‰å…³é”®ç‰¹å¾å¤šæºèåˆï¼ˆGPS + WiFi + è“ç‰™ + å†å²ï¼‰
- å†³ç­–æ ‘å¯èµ°å¤šæ¡è·¯å¾„ï¼Œç½®ä¿¡åº¦æ²¿è·¯å¾„ç›¸ä¹˜
- æœ€ç»ˆæŒ‰ç½®ä¿¡åº¦åˆ†çº§å“åº”

#### LinUCBï¼ˆè¯­ä¹‰èåˆï¼‰

ä¸€ä¸ªå…¨å±€ LinUCBï¼Œè¾“å…¥è¯­ä¹‰èåˆåçš„çŠ¶æ€å‘é‡ï¼š

```
State = concat(
  raw_features,     // åŸå§‹æ„ŸçŸ¥ç‰¹å¾ ~20ç»´
  context_vector,   // å¶èŠ‚ç‚¹è¯­ä¹‰åŠ æƒèåˆ ~10ç»´
  history_features, // æ¨é€æ¬¡æ•°/æœ€è¿‘åé¦ˆ ~10ç»´
) â†’ æ€»è®¡ ~40ç»´

score(action) = Î¸áµ€x + Î±âˆš(xáµ€Aâ»Â¹x)
æ›´æ–°ï¼šA = Î³A + xxáµ€, b = Î³b + rx ï¼ˆÎ³=0.998 æ—¶é—´è¡°å‡ï¼‰
```

### 5.3 æ‰§è¡ŒåŸŸæ¶æ„

#### æ‰§è¡Œæµæ°´çº¿

```plantuml
@startuml
start
:Decision (æ¥è‡ªå†³ç­–åŸŸ);
:éšç§è¿‡æ»¤;
note right: ğŸ”´é˜»æ–­ / ğŸŸ¡è„±æ•\nğŸŸ¢é€šè¿‡ / ğŸ”µè¯·æ±‚æˆæƒ
if (éšç§é€šè¿‡?) then (æ˜¯)
  :å†…å®¹ç”Ÿæˆ;
  note right: æ¨¡æ¿å¡«å……(<10ms)\nAPIæ‹¼è£…(100-500ms)\nLLMç”Ÿæˆ(500-2000ms)
  :å½¢å¼é€‰æ‹©;
  note right: ç´§æ€¥åº¦ Ã— ç”¨æˆ·çŠ¶æ€ çŸ©é˜µ
  :æ—¶æœºè°ƒåº¦;
  note right: ç«‹å³ / ç­‰è§£é”\nç­‰ç©ºé—² / åˆå¹¶æ¨é€
  :å¤šæ¨¡æ€è¾“å‡º;
  note right: æ–‡å­— + å¡ç‰‡ + è¯­éŸ³\n+ å¿«æ·æ“ä½œæŒ‰é’®
  :åé¦ˆé‡‡é›†å¼€å§‹;
else (é˜»æ–­)
  stop
endif
stop
@enduml
```

#### æ¨é€å½¢å¼çŸ©é˜µ

```
            ç©ºé—²        å¿™ç¢Œ        å¼€ä¼š        ç¡è§‰        å¼€è½¦
ğŸ”´ ç«‹å³    å…¨å±+å£°éŸ³   æ¨ªå¹…+éœ‡åŠ¨   æ¨ªå¹…+éœ‡åŠ¨   å…¨å±+å£°éŸ³   è¯­éŸ³æ’­æŠ¥
ğŸŸ¡ å°½å¿«    æ¨ªå¹…        å°çº¢ç‚¹      é™é»˜        é™é»˜        è¯­éŸ³
ğŸŸ¢ ç¨å    å°çº¢ç‚¹      é™é»˜        é™é»˜        é™é»˜        é™é»˜
âšª èƒŒæ™¯    é™é»˜        é™é»˜        é™é»˜        é™é»˜        é™é»˜
```

ä½ç½®ä¿¡åº¦ï¼ˆ<0.6ï¼‰è‡ªåŠ¨é™ä¸€çº§ï¼ˆå…¨å±â†’æ¨ªå¹…â†’å°çº¢ç‚¹â†’é™é»˜ï¼‰ã€‚

#### åˆå¹¶æ¨é€

5åˆ†é’Ÿå†…å¤šæ¡ ğŸŸ¢/âšª æ¨é€åˆå¹¶ä¸ºä¸€æ¡æ‘˜è¦é€šçŸ¥ã€‚

### 5.4 å­¦ä¹ åŸŸæ¶æ„

#### å¥–åŠ±è®¡ç®—

```python
reward = base_reward              # æ˜¾å¼/éšå¼åé¦ˆ
       + disturbance_penalty      # -0.1 Ã— (æœ€è¿‘æ¨é€æ¬¡æ•°^1.5)
       + accuracy_bonus           # æ¨å¯¹äº†+0.5 / è¯¥æ¨æ²¡æ¨-1.0
```

æ—¶æ®µåŠ æƒï¼šç¡è§‰Ã—3ã€å¼€ä¼šÃ—2ã€å¼€è½¦Ã—2.5ã€‚

#### 5å±‚é²æ£’æ€§é˜²æŠ¤

| å±‚ | é˜²æŠ¤ | æœºåˆ¶ |
|----|------|------|
| è¾“å…¥ | ç‰¹å¾å¼‚å¸¸ | èŒƒå›´æ£€æŸ¥ + ç¼ºå¤±å€¼å¡«å…… |
| åé¦ˆ | å¼‚å¸¸åé¦ˆ | 3Ïƒæ£€æµ‹ + é¢‘ç‡é™åˆ¶ + å¥–åŠ±è£å‰ª |
| æ¨¡å‹ | å‚æ•°ä¿æŠ¤ | æ—¶é—´è¡°å‡Î³ + å˜åŒ–é™åˆ¶5% + æ¡ä»¶æ•°ç›‘æ§ |
| è¾“å‡º | ä¸ç¡®å®šæ€§ | ç½®ä¿¡åº¦æ£€æŸ¥ + ä¸ç¡®å®šæ—¶å›é€€è§„åˆ™ |
| ç³»ç»Ÿ | æ•´ä½“é€€åŒ– | æ¯æ—¥æ£€æŸ¥ç‚¹ + æ€§èƒ½ç›‘æ§ + è‡ªåŠ¨å›æ»š |

#### å†·å¯åŠ¨

| é˜¶æ®µ | è§„åˆ™ | RL | è¯´æ˜ |
|------|------|-----|------|
| å‰2å‘¨ | 100% | 0% | åªæ”¶é›†æ•°æ® |
| ç¬¬2å‘¨ | 70% | 30% | å¼€å§‹å‚ä¸ |
| ç¬¬4å‘¨+ | 30% | 70% | é€æ­¥æ”¾æƒ |
| ç¨³å®šå | å…œåº• | ä¸»å¯¼ | RL ä¸ç¡®å®šæ—¶ç”¨è§„åˆ™ |

### 5.5 æ•°æ®æµå…¨æ™¯

```plantuml
@startuml
skinparam activity {
  BackgroundColor<<perception>> #D5E8D4
  BackgroundColor<<decision>> #DCEEFB
  BackgroundColor<<execution>> #FFF2CC
  BackgroundColor<<learning>> #F8CECC
}

|æ„ŸçŸ¥åŸŸ|
start
:ä¼ æ„Ÿå™¨ / é€šçŸ¥;
:æ„ŸçŸ¥æ’ä»¶ç¼–ç ;
note right: EncodedEvent\n{distribution, features, quality}

|å†³ç­–åŸŸ|
:å†³ç­–æ ‘ (è½¯åŒ¹é…);
note right: å¤šå¶èŠ‚ç‚¹\n[{leaf, confidence}]
:è¯­ä¹‰èåˆ;
note right: context_vector
:LinUCB é€‰æ‹©åŠ¨ä½œ;
note right: Decision\n{intent, confidence, action, trace}

|æ‰§è¡ŒåŸŸ|
:éšç§è¿‡æ»¤;
:å†…å®¹ç”Ÿæˆ;
note right: ActionContent\n{text, card, voice}
:å½¢å¼é€‰æ‹© + æ—¶æœºè°ƒåº¦;
:æ¨é€ç»™ç”¨æˆ·;

|å­¦ä¹ åŸŸ|
:ç”¨æˆ·åé¦ˆ;
note right: Feedback\n{action_id, response, delay}
:å¥–åŠ±è®¡ç®—;
note right: reward = base\n+ disturbance_penalty\n+ accuracy_bonus
:LinUCB æ›´æ–°;
note right: A = Î³A + xxáµ€\nb = Î³b + rx

|å†³ç­–åŸŸ|
:å‚æ•°å·²æ›´æ–°;
stop
@enduml
```

---

## 6. Narrow-down â€” æŠ€æœ¯è¦ç‚¹

### 6.1 å†³ç­–æ ‘è‡ªåŠ¨ç¼–è¯‘

**Key é€‰æ‹©ç­–ç•¥ï¼š** `score = coverage Ã— discrimination / cost`

```typescript
const featureCosts: Record<string, number> = {
  'weekday': 1, 'hour': 1, 'charging': 1, 'battery': 1,  // å…è´¹
  'keyword': 2, 'sender': 2, 'app': 2,                    // è½»é‡
  'location': 10, 'activity': 10,                         // éœ€è¦ä¼ æ„Ÿå™¨
  'noise': 15, 'heartrate': 20,                           // æ˜‚è´µ
};
```

ä¾¿å®œçš„ key æ”¾ä¸Šå±‚ â†’ æå‰å‰ªæ â†’ é¿å…ä¸å¿…è¦çš„ä¼ æ„Ÿå™¨æŸ¥è¯¢ã€‚

### 6.2 è½¯åŒ¹é…ç­–ç•¥

**æ—¶é—´ï¼š** é«˜æ–¯è¡°å‡ï¼Œå®¹å·®å†…1.0ï¼Œè¶…å‡ºæŒ‡æ•°è¡°å‡
```
target=7:30, tolerance=30min:
7:30â†’1.0, 7:00â†’1.0, 6:50â†’0.85, 6:30â†’0.45, 6:00â†’0.05
```

**ä½ç½®ï¼š** å¤šæºèåˆå–æœ€é«˜
```
GPS(å¦‚æœæœ‰) + WiFi SSID(0.95) + è“ç‰™è®¾å¤‡(0.8) + å†å²æ¨æ–­
â†’ max(scores)
```

**ç¼ºå¤±æ•°æ®ï¼š** confidence=0.5ï¼ˆä¸­æ€§ï¼‰ï¼Œä¸æ˜¯0ï¼ˆå¦å®šï¼‰

### 6.3 LinUCB ç®—æ³•ç»†èŠ‚

```
é€‰åŠ¨ä½œï¼šscore = Î¸áµ€x + Î±âˆš(xáµ€Aâ»Â¹x)
æ›´æ–°ï¼š  A = Î³A + xxáµ€, b = Î³b + rx
å‚æ•°ï¼š  dâ‰ˆ40, Î±=1.0, Î³=0.998
å†…å­˜ï¼š  A(40Ã—40) Ã— 10åŠ¨ä½œ Ã— 4å­—èŠ‚ â‰ˆ 70KB
æ›´æ–°è€—æ—¶ï¼š<0.01ms
```

**è¯­ä¹‰èåˆï¼š** å¶èŠ‚ç‚¹â†’è¯­ä¹‰å‘é‡ï¼ˆä»è§„åˆ™æ¡ä»¶è‡ªåŠ¨ç”Ÿæˆï¼‰â†’ æŒ‰ç½®ä¿¡åº¦åŠ æƒèåˆ â†’ ä¸€ä¸ªå…¨å±€ LinUCB

**æ¢ç´¢ç­–ç•¥ï¼š** ğŸ”´ç´§æ€¥ä¸æ¢ç´¢ï¼›ä½é£é™©+ç”¨æˆ·é—²ç€ Îµ=0.2ï¼›å…¶ä»– Îµ=0.05

### 6.4 é²æ£’æ€§è¯¦ç»†è®¾è®¡

**æ—¶é—´è¡°å‡ï¼š** Î³=0.998ï¼ŒåŠè¡°æœŸâ‰ˆ346æ¬¡ï¼ˆçº¦2å‘¨ï¼‰ï¼Œæ—§ä¹ æƒ¯è‡ªåŠ¨æ·¡å‡º

**å¼‚å¸¸æ£€æµ‹ï¼š** å¥–åŠ±åç¦»3Ïƒ / 1åˆ†é’Ÿå†…>5æ¡åé¦ˆ / ç‰¹å¾è¶…å‡ºèŒƒå›´ â†’ è¿‡æ»¤

**å›æ»šï¼š** æ¯æ—¥å¿«ç…§ï¼Œæ€§èƒ½ä¸‹é™30% â†’ è‡ªåŠ¨æ¢å¤æ£€æŸ¥ç‚¹

### 6.5 æ—¶åºè§„åˆ™

```typescript
interface TemporalCondition {
  event: string;                              // äº‹ä»¶ç±»å‹
  window: number;                             // æ—¶é—´çª—å£(ms)
  count?: { min?: number, max?: number };
  sequence?: string[];                        // æœ‰åºäº‹ä»¶åºåˆ—
}
```

å®ç°ï¼šäº‹ä»¶ç¯å½¢ç¼“å†²åŒºï¼ˆæœ€è¿‘7å¤©ï¼Œæœ€å¤š10000æ¡ï¼‰ï¼ŒO(N) æ‰«æã€‚

### 6.6 Cooldown + åˆå¹¶æ¨é€

```typescript
interface CooldownConfig {
  duration: number;       // æœ€å°é—´éš”(ms)
  scope: 'rule' | 'intent';  // å»é‡èŒƒå›´
  resetOn?: string;       // é‡ç½®äº‹ä»¶
  merge?: boolean;        // å†·å´æœŸé—´åˆå¹¶
}
```

### 6.7 å†·å¯åŠ¨ç­–ç•¥

MVP å…ˆç”¨ç»Ÿè®¡å­¦ä¹ ï¼ˆæ¯ä¸ªå¶èŠ‚ç‚¹çš„åŠ¨ä½œå¹³å‡å¥–åŠ±è¡¨ï¼‰ï¼Œå†å‡çº§åˆ° LinUCBã€‚

### 6.8 ç«¯ä¾§è®­ç»ƒæ–¹æ¡ˆ

| é˜¶æ®µ | æ–¹æ¡ˆ | è¯´æ˜ |
|------|------|------|
| MVP | ç»Ÿè®¡å­¦ä¹ ï¼ˆæ— éœ€æ¢¯åº¦ï¼‰ | å¹³å‡å¥–åŠ±è¡¨ï¼Œargmax |
| Phase 2 | C++ æ‰‹å†™ LinUCB | çŸ©é˜µè¿ç®—ï¼Œ<100è¡Œä»£ç  |
| Phase 3 | MindSpore Liteï¼ˆå¦‚æœæ”¯æŒè®­ç»ƒï¼‰ | åä¸ºåŸç”Ÿ |

---

## 7. Entity â€” å®ç°è®¾è®¡

### 7.1 æ ¸å¿ƒæ•°æ®ç»“æ„

```typescript
// è§„åˆ™
interface SmartRule {
  id: string;
  name: string;
  enabled: boolean;
  conditions: Map<string, RuleCondition>;
  conditionGroups?: Map<string, RuleCondition>[];
  temporal?: TemporalCondition;
  extends?: string[];
  intent: string;
  priority: string;
  action: string;
  cooldown?: CooldownConfig;
}

// å†³ç­–æ ‘èŠ‚ç‚¹
interface ExecNode {
  key: string;
  branches: Map<Object, ExecNode | LeafNode>;
  fallthrough?: ExecNode;
}

// å¶èŠ‚ç‚¹
interface LeafNode {
  rules: SmartRule[];
  semantic: number[];  // è¯­ä¹‰å‘é‡
}

// åŒ¹é…ç»“æœ
interface MatchResult {
  rule: SmartRule;
  confidence: number;
  path: { key: string, actual: Object, expected: Object, confidence: number }[];
}

// å†³ç­–è¾“å‡º
interface Decision {
  intent: string;
  confidence: number;
  priority: string;
  action: string;
  actionParams: Record<string, string>;
  trace: DecisionTrace;
}

// ç¼–ç å™¨è¾“å‡º
interface EncodedOutput {
  distribution: Map<string, number>;
  features: number[];
  quality: number;
  summary?: string;
}
```

### 7.2 C++ æ¨¡å—è®¾è®¡

```cpp
// è§„åˆ™ç¼–è¯‘å™¨
class RuleCompiler {
  ExecNode* compile(vector<Rule>& rules);
  string selectBestKey(vector<Rule>& rules);
  SemanticVector generateSemantic(Rule& rule);
};

// å†³ç­–æ ‘æ‰§è¡Œ
class DecisionTree {
  vector<MatchResult> evaluateSoft(ExecNode* root, Context& ctx);
};

// è½¯åŒ¹é…å™¨
class SoftMatcher {
  float match(string key, Value actual, Value expected);
  float matchLocation(string target, LocationSources& sources);
  float matchHour(float actual, float target, float tolerance);
};

// LinUCB ç­–ç•¥
class RobustLinUCB {
  int selectAction(VectorXf& x);
  void update(int arm, VectorXf& x, float reward);
  // å†…ç½®ï¼šæ—¶é—´è¡°å‡ã€å¼‚å¸¸è¿‡æ»¤ã€å¥–åŠ±è£å‰ª
};

// äº‹ä»¶ç¼“å†²åŒº
class EventRingBuffer {
  void push(Event& e);
  int countInWindow(string event, int64_t windowMs);
  bool matchSequence(vector<string>& seq, int64_t windowMs);
};

// Cooldown ç®¡ç†
class CooldownManager {
  bool isInCooldown(string ruleId);
  void startCooldown(string ruleId, int64_t durationMs);
  void mergeEvent(string ruleId, Event& e);
};

// å†³ç­–è¿½æº¯
class DecisionTracer {
  void record(vector<MatchResult>& results, Context& ctx);
  string getHistory(int limit);  // JSON
};

// æ¨¡å‹æ£€æŸ¥ç‚¹
class ModelCheckpoint {
  void save(RobustLinUCB& model);
  void maybeRollback(RobustLinUCB& model, float currentAvgReward);
};
```

### 7.3 NAPI æ¥å£å®šä¹‰

```typescript
// ArkTS ä¾§è°ƒç”¨ C++ å¼•æ“
import ruleEngine from 'libruleengine.so';

// è§„åˆ™ç®¡ç†
ruleEngine.loadRules(rulesJson: string): boolean;
ruleEngine.compileTree(): boolean;

// äº‹ä»¶è¾“å…¥
ruleEngine.pushEvent(eventJson: string): void;

// å†³ç­–
ruleEngine.evaluate(contextJson: string): string;  // â†’ Decision JSON

// åé¦ˆ
ruleEngine.feedback(ruleId: string, reward: number): void;

// è¿½æº¯
ruleEngine.getTraceHistory(limit: number): string;  // â†’ JSON

// æ¨¡å‹ç®¡ç†
ruleEngine.saveModel(path: string): boolean;
ruleEngine.loadModel(path: string): boolean;
ruleEngine.resetModel(): boolean;
```

### 7.4 ArkTS æœåŠ¡è®¾è®¡

```typescript
// æƒ…æ™¯æ™ºèƒ½ä¸»æœåŠ¡
class ContextAIService {
  // åˆå§‹åŒ–å¼•æ“
  async init(): Promise<void>;
  
  // äº‹ä»¶å¾ªç¯ï¼šæ¥æ”¶æ„ŸçŸ¥äº‹ä»¶ â†’ å†³ç­– â†’ æ‰§è¡Œ
  async onEvent(event: EncodedEvent): Promise<void>;
  
  // æ‰§è¡Œæµæ°´çº¿
  async executeAction(decision: Decision): Promise<void>;
}

// æ„ŸçŸ¥æ’ä»¶ç®¡ç†
class PluginManager {
  registerPlugin(plugin: PerceptionPlugin): void;
  startAll(): void;
  stopAll(): void;
}

// å†…å®¹ç”Ÿæˆå™¨
class ContentGenerator {
  async generate(intent: string, context: Context): Promise<ActionContent>;
}

// åé¦ˆé‡‡é›†å™¨
class FeedbackCollector {
  watch(actionId: string): void;
  onUserResponse(actionId: string, response: UserResponse): void;
}
```

### 7.5 å­˜å‚¨è®¾è®¡

```
entry/src/main/resources/
â””â”€â”€ rawfile/
    â””â”€â”€ context_ai/
        â””â”€â”€ default_rules.json     # é¢„è®¾è§„åˆ™åº“

AppData/
â””â”€â”€ context_ai/
    â”œâ”€â”€ rules/
    â”‚   â”œâ”€â”€ user_rules.json        # ç”¨æˆ·è‡ªå®šä¹‰è§„åˆ™
    â”‚   â””â”€â”€ templates.json         # è§„åˆ™æ¨¡æ¿
    â”œâ”€â”€ model/
    â”‚   â”œâ”€â”€ linucb_params.bin      # LinUCB å‚æ•° (~70KB)
    â”‚   â”œâ”€â”€ action_stats.json      # ç»Ÿè®¡å­¦ä¹ æ•°æ®ï¼ˆMVPï¼‰
    â”‚   â””â”€â”€ checkpoints/           # å†å²æ£€æŸ¥ç‚¹
    â”œâ”€â”€ data/
    â”‚   â”œâ”€â”€ event_buffer.bin       # äº‹ä»¶ç¯å½¢ç¼“å†²åŒº
    â”‚   â”œâ”€â”€ feedback_log.db        # åé¦ˆæ—¥å¿—
    â”‚   â””â”€â”€ decision_trace.db      # å†³ç­–è¿½æº¯ï¼ˆæœ€è¿‘1000æ¡ï¼‰
    â””â”€â”€ config/
        â””â”€â”€ learning_config.json   # å­¦ä¹ å‚æ•°ï¼ˆÎ³, Î±ç­‰ï¼‰
```

æ€»å­˜å‚¨ï¼š< 5MB

### 7.6 ç›®å½•ç»“æ„

**è®¾è®¡ç›®æ ‡ç›®å½•ï¼ˆè§„åˆ’ï¼‰ï¼š**

```
entry/src/main/
â”œâ”€â”€ ets/
â”‚   â””â”€â”€ service/
â”‚       â””â”€â”€ contextai/
â”‚           â”œâ”€â”€ ContextAIService.ets    # ä¸»æœåŠ¡
â”‚           â”œâ”€â”€ PluginManager.ets       # æ’ä»¶ç®¡ç†
â”‚           â”œâ”€â”€ ContentGenerator.ets    # å†…å®¹ç”Ÿæˆ
â”‚           â”œâ”€â”€ DeliveryManager.ets     # æ¨é€å½¢å¼+æ—¶æœº
â”‚           â”œâ”€â”€ FeedbackCollector.ets   # åé¦ˆé‡‡é›†
â”‚           â””â”€â”€ plugins/                # æ„ŸçŸ¥æ’ä»¶
â”‚               â”œâ”€â”€ LocationPlugin.ets
â”‚               â”œâ”€â”€ TimePlugin.ets
â”‚               â”œâ”€â”€ NotificationPlugin.ets
â”‚               â””â”€â”€ MotionPlugin.ets
â”œâ”€â”€ cpp/
â”‚   â””â”€â”€ rule_engine/
â”‚       â”œâ”€â”€ CMakeLists.txt
â”‚       â”œâ”€â”€ napi_entry.cpp              # NAPI ç»‘å®š
â”‚       â”œâ”€â”€ rule_compiler.h/cpp         # è§„åˆ™ç¼–è¯‘å™¨
â”‚       â”œâ”€â”€ decision_tree.h/cpp         # å†³ç­–æ ‘
â”‚       â”œâ”€â”€ soft_matcher.h/cpp          # è½¯åŒ¹é…
â”‚       â”œâ”€â”€ linucb.h/cpp                # LinUCB
â”‚       â”œâ”€â”€ event_buffer.h/cpp          # äº‹ä»¶ç¼“å†²
â”‚       â”œâ”€â”€ cooldown.h/cpp              # å†·å´ç®¡ç†
â”‚       â”œâ”€â”€ decision_tracer.h/cpp       # å†³ç­–è¿½æº¯
â”‚       â”œâ”€â”€ feedback_validator.h/cpp    # å¼‚å¸¸æ£€æµ‹
â”‚       â”œâ”€â”€ model_checkpoint.h/cpp      # æ£€æŸ¥ç‚¹
â”‚       â””â”€â”€ json_utils.h/cpp            # JSON å·¥å…·
â””â”€â”€ resources/rawfile/context_ai/
    â””â”€â”€ default_rules.json
```

**å®é™…å·²å®ç°ç›®å½•ï¼ˆv2.38.0ï¼Œ2026-02-20ï¼‰ï¼š**

```
entry/src/main/
â”œâ”€â”€ ets/service/context/                      # ArkTS æƒ…æ™¯æ™ºèƒ½æœåŠ¡
â”‚   â”œâ”€â”€ ContextAwarenessService.ets           # ä¸»æœåŠ¡ï¼ˆæ„ŸçŸ¥ + è°ƒåº¦ï¼‰
â”‚   â”œâ”€â”€ ContextEngine.ets                     # å†³ç­–å¼•æ“ ArkTS åŒ…è£…
â”‚   â”œâ”€â”€ ContextModels.ets                     # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ DataTray.ets                          # ä¼ æ„Ÿå™¨æ•°æ®æ‰˜ç›˜ï¼ˆNAPI åŒ…è£…ï¼‰
â”‚   â”œâ”€â”€ GeoUtils.ets                          # åœ°ç†è®¡ç®—ï¼ˆNAPI åŒ…è£…ï¼‰
â”‚   â”œâ”€â”€ Dbscan.ets                            # DBSCAN èšç±»ï¼ˆNAPI åŒ…è£…ï¼‰
â”‚   â”œâ”€â”€ LocationFusionNative.ets              # ä½ç½®èåˆï¼ˆNAPI åŒ…è£…ï¼‰
â”‚   â”œâ”€â”€ LocationFusionService.ets             # ä½ç½®èåˆä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ LocationDiscoveryService.ets          # ä½ç½®å‘ç° + å­¦ä¹ 
â”‚   â”œâ”€â”€ GeofenceManager.ets                   # å›´æ ç®¡ç†
â”‚   â”œâ”€â”€ BehaviorLogger.ets                    # è¡Œä¸ºæ—¥å¿—
â”‚   â”œâ”€â”€ SensorDataTray.ets                    # æ—§ç‰ˆæ•°æ®æ‰˜ç›˜ï¼ˆä¿ç•™å¤‡ç”¨ï¼‰
â”‚   â””â”€â”€ plugins/                              # æ„ŸçŸ¥æ’ä»¶
â”‚       â”œâ”€â”€ MotionPlugin.ets                  # è¿åŠ¨çŠ¶æ€
â”‚       â”œâ”€â”€ BatteryPlugin.ets                 # ç”µé‡/å……ç”µ
â”‚       â”œâ”€â”€ NetworkPlugin.ets                 # ç½‘ç»œçŠ¶æ€
â”‚       â”œâ”€â”€ ScreenStatePlugin.ets             # å±å¹•çŠ¶æ€
â”‚       â””â”€â”€ DigitalWorldPlugin.ets            # æ•°å­—ä¸–ç•Œï¼ˆé€šçŸ¥æ‹¦æˆªï¼‰
â”‚
â”œâ”€â”€ cpp/                                      # C++ NAPI æ¨¡å—
â”‚   â”œâ”€â”€ CMakeLists.txt                        # æ ¹ CMakeï¼ˆæ³¨å†Œæ‰€æœ‰å­æ¨¡å—ï¼‰
â”‚   â”œâ”€â”€ napi_exec.cpp                         # exec æ¨¡å—
â”‚   â”œâ”€â”€ context_engine/                       # å†³ç­–å¼•æ“ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt
â”‚   â”‚   â”œâ”€â”€ context_engine.h                  # å¤´æ–‡ä»¶ï¼ˆRule, MatchResult, RuleEngine ç­‰ï¼‰
â”‚   â”‚   â”œâ”€â”€ context_engine_napi.cpp           # NAPI ç»‘å®š
â”‚   â”‚   â”œâ”€â”€ rule_engine.cpp                   # è§„åˆ™å¼•æ“ï¼ˆevaluate + cooldown + rate limitï¼‰
â”‚   â”‚   â”œâ”€â”€ decision_tree.cpp                 # å†³ç­–æ ‘è‡ªåŠ¨ç¼–è¯‘
â”‚   â”‚   â”œâ”€â”€ soft_match.cpp                    # è½¯åŒ¹é…ï¼ˆin/eq/lte/gte/range/neq + è¡°å‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ mab.cpp                           # Multi-Armed Bandit
â”‚   â”‚   â””â”€â”€ linucb.cpp                        # LinUCB ç®—æ³•
â”‚   â”œâ”€â”€ data_tray/                            # ä¼ æ„Ÿå™¨æ•°æ®ç¼“å­˜ï¼ˆTTL + è´¨é‡è¡°å‡ï¼‰
â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt
â”‚   â”‚   â”œâ”€â”€ data_tray.h                       # å¤´æ–‡ä»¶ï¼ˆå•ä¾‹ï¼Œçº¿ç¨‹å®‰å…¨ï¼‰
â”‚   â”‚   â””â”€â”€ data_tray_napi.cpp                # NAPI ç»‘å®š
â”‚   â”œâ”€â”€ geo_utils/                            # åœ°ç†è®¡ç®—
â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt
â”‚   â”‚   â”œâ”€â”€ geo_utils.h                       # Haversine + å›´æ æ£€æµ‹
â”‚   â”‚   â””â”€â”€ geo_utils_napi.cpp                # NAPI ç»‘å®š
â”‚   â”œâ”€â”€ dbscan_cluster/                       # DBSCAN èšç±»
â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt
â”‚   â”‚   â”œâ”€â”€ dbscan_cluster.h                  # DBSCAN + æ—¶é—´æ¨¡å¼ + ç±»åˆ«æ¨æ–­
â”‚   â”‚   â””â”€â”€ dbscan_cluster_napi.cpp           # NAPI ç»‘å®š
â”‚   â”œâ”€â”€ location_fusion/                      # å¤šæºä½ç½®èåˆ
â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt
â”‚   â”‚   â”œâ”€â”€ location_fusion.h                 # GPS/WiFi/BT ç½®ä¿¡åº¦èåˆ
â”‚   â”‚   â””â”€â”€ location_fusion_napi.cpp          # NAPI ç»‘å®š
â”‚   â”œâ”€â”€ voiceprint/                           # å£°çº¹è¯†åˆ«
â”‚   â””â”€â”€ types/                                # TypeScript å£°æ˜
â”‚       â”œâ”€â”€ libdata_tray/                     # index.d.ts + oh-package.json5
â”‚       â”œâ”€â”€ libgeo_utils/
â”‚       â”œâ”€â”€ libdbscan/
â”‚       â””â”€â”€ liblocation_fusion/
â”‚
â”œâ”€â”€ ets/service/gateway/                      # OpenClaw èŠ‚ç‚¹èƒ½åŠ›
â”‚   â”œâ”€â”€ NodeRuntime.ets                       # å« context.test invoke handler
â”‚   â””â”€â”€ GatewayProtocol.ets                   # å« Command.CONTEXT_TEST
```

### 7.7 å®æ–½è·¯çº¿å›¾

| é˜¶æ®µ | å‘¨æœŸ | ç›®æ ‡ | äº¤ä»˜ç‰© |
|------|------|------|--------|
| **MVP** | 4å‘¨ | åŸºç¡€è§„åˆ™å¼•æ“ + 4ä¸ªæ ¸å¿ƒç”¨ä¾‹ | ç¡¬åŒ¹é…å†³ç­–æ ‘ + æ¨¡æ¿é€šçŸ¥ + ç»Ÿè®¡å­¦ä¹  |
| **Phase 2** | 4å‘¨ | è½¯åŒ¹é… + LinUCB + é€šçŸ¥æ‹¦æˆª | æ¦‚ç‡åˆ†å¸ƒç¼–ç  + LinUCB + 8ä¸ªç”¨ä¾‹ |
| **Phase 3** | 4å‘¨ | æ—¶åºè§„åˆ™ + è¯­éŸ³ + é²æ£’æ€§ | äº‹ä»¶ç¼“å†² + TTS + 5å±‚é˜²æŠ¤ + 12ä¸ªç”¨ä¾‹ |
| **Phase 4** | æŒç»­ | LLM å…œåº• + è”é‚¦å­¦ä¹  + æ›´å¤šæ’ä»¶ | å®Œæ•´ç³»ç»Ÿ |

**MVP è¯¦ç»†ï¼š**
1. Week 1: C++ å†³ç­–æ ‘ï¼ˆç¡¬åŒ¹é…ï¼‰+ NAPI æ¥å£
2. Week 2: 4ä¸ªæ„ŸçŸ¥æ’ä»¶ï¼ˆæ—¶é—´/ä½ç½®/ç”µé‡/é€šçŸ¥ï¼‰
3. Week 3: ArkTS æ‰§è¡Œå±‚ï¼ˆé€šçŸ¥æ¨é€ + æ¨¡æ¿å†…å®¹ï¼‰
4. Week 4: ç»Ÿè®¡å­¦ä¹  + åé¦ˆé‡‡é›† + åŸºç¡€UI

---

## 8. å®æ–½è®°å½• â€” C++ NAPI è¿ç§»

> æ—¥æœŸï¼š2026-02-20
> åŸåˆ™ï¼šArkTS åªè´Ÿè´£ UI + HarmonyOS API è°ƒç”¨ + NAPI æ¡¥æ¥ï¼›æ‰€æœ‰è®¡ç®—ã€ç¼“å­˜ã€ç®—æ³•åœ¨ C++

### 8.1 è¿ç§»åŸåˆ™

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **C++ åšè®¡ç®—** | è·ç¦»è®¡ç®—ã€èšç±»ã€èåˆã€è§„åˆ™åŒ¹é…å…¨éƒ¨ native |
| **ArkTS åšæ¡¥æ¥** | è–„åŒ…è£…å±‚ï¼Œä»…åš JSON è½¬æ¢ + è°ƒç”¨ NAPI |
| **ArkTS åšç³»ç»Ÿè°ƒç”¨** | ä¼ æ„Ÿå™¨ã€GPSã€WiFiã€è“ç‰™ã€é€šçŸ¥ç­‰ HarmonyOS Kit API åªèƒ½ ArkTS è°ƒç”¨ |
| **Header-only å®ç°** | æ–°æ¨¡å—é‡‡ç”¨å¤´æ–‡ä»¶å®ç° + ç‹¬ç«‹ NAPI ç»‘å®š .cppï¼Œç®€åŒ–ç¼–è¯‘ |
| **Singleton æ¨¡å¼** | data_tray ç”¨ `std::mutex` ä¿è¯çº¿ç¨‹å®‰å…¨çš„å•ä¾‹ |

### 8.2 æ–°å¢ C++ æ¨¡å—

| æ¨¡å— | SO å | åŠŸèƒ½ | å…³é”®ç®—æ³• |
|------|-------|------|---------|
| **data_tray** | libdata_tray.so | ä¼ æ„Ÿå™¨æ•°æ®ç¼“å­˜ | TTL è¿‡æœŸ + è´¨é‡è¡°å‡ï¼ˆçº¿æ€§æ’å€¼ï¼‰|
| **geo_utils** | libgeo_utils.so | åœ°ç†è·ç¦»è®¡ç®— | Haversine å…¬å¼ + å¤šè¾¹å½¢å›´æ å°„çº¿æ³• |
| **dbscan_cluster** | libdbscan.so | ä½ç½®èšç±» + å­¦ä¹  | DBSCAN + æ—¶é—´æ¨¡å¼åˆ†æ + ç±»åˆ«æ¨æ–­ |
| **location_fusion** | liblocation_fusion.so | å¤šæºä½ç½®èåˆ | GPS/WiFi/BT ç½®ä¿¡åº¦åŠ æƒèåˆ |

**å·²æœ‰ C++ æ¨¡å—ï¼ˆè¿ç§»å‰ï¼‰ï¼š**

| æ¨¡å— | SO å | åŠŸèƒ½ |
|------|-------|------|
| **context_engine** | libcontext_engine.so | è§„åˆ™å¼•æ“ + å†³ç­–æ ‘ + è½¯åŒ¹é… + LinUCB + MAB + äº‹ä»¶ç¼“å†² |
| **voiceprint** | libvoiceprint.so | å£°çº¹è¯†åˆ«ï¼ˆstubï¼‰ |
| **exec** | libexec.so | Shell å‘½ä»¤æ‰§è¡Œ |

### 8.3 ArkTS åŒ…è£…å±‚

| åŒ…è£…æ–‡ä»¶ | å¯¹åº” C++ æ¨¡å— | æ›¿ä»£çš„æ—§ ArkTS å®ç° |
|---------|--------------|-------------------|
| DataTray.ets | data_tray | SensorDataTray.etsï¼ˆä¿ç•™å¤‡ç”¨ï¼‰|
| GeoUtils.ets | geo_utils | GeofenceManager å†…è”è·ç¦»è®¡ç®— |
| Dbscan.ets | dbscan_cluster | LocationDiscoveryService å†…è” DBSCAN |
| LocationFusionNative.ets | location_fusion | LocationFusionService å†…è”ç½®ä¿¡åº¦è®¡ç®— |

### 8.4 å·²ä¿®å¤é—®é¢˜

| é—®é¢˜ | æ–‡ä»¶ | ä¿®å¤ |
|------|------|------|
| context_engine æœªç¼–è¯‘ | cpp/CMakeLists.txt | æ·»åŠ  `add_subdirectory(context_engine)` |
| ImportLinUCB å‡½æ•°æœªé—­åˆ | context_engine_napi.cpp | æ·»åŠ  `return nullptr;` å’Œ `}` |
| loadRules ä¸æ¸… cooldown | rule_engine.cpp | loadRules æ—¶æ¸…ç©º lastFired_/categoryFirings_/globalFirings_ |

### 8.5 è¿œç¨‹æµ‹è¯•èƒ½åŠ› â€” context.test

é€šè¿‡ OpenClaw Node invoke åè®®å®ç°è¿œç¨‹åœºæ™¯æ³¨å…¥æµ‹è¯•ã€‚

**è°ƒç”¨é“¾è·¯ï¼š**
```
Server (nodes invoke) â†’ Gateway â†’ Susan (WebSocket) â†’ NodeRuntime.handleContextTest()
  â†’ ContextEngineService.init() â†’ nativeLoadRules() â†’ nativeEvaluate() â†’ è¿”å› MatchResult[]
```

**invoke å‚æ•°ï¼š**
```json
{
  "scenario": "åœºæ™¯åç§°",
  "loadDefaultRules": true,           // å¯é€‰ï¼šé‡æ–°åŠ è½½å†…ç½®è§„åˆ™ï¼ˆå«æ¸…ç©º cooldownï¼‰
  "geofences": [                      // å¯é€‰ï¼šç»‘å®šå›´æ 
    { "id": "work_001", "category": "work" }
  ],
  "snapshot": {                       // å¿…å¡«ï¼šæ¨¡æ‹Ÿçš„ ContextSnapshot
    "timeOfDay": "morning",
    "hour": "8",
    "dayOfWeek": "1",
    "isWeekend": "false",
    "motionState": "walking",
    "batteryLevel": "10",
    "isCharging": "false",
    "networkType": "cellular",
    "geofence": "work_001"            // å¯é€‰
  },
  "maxResults": 5                     // å¯é€‰ï¼šæœ€å¤§è¿”å›æ•°
}
```

**Gateway é…ç½®ï¼š** `gateway.nodes.allowCommands` éœ€åŒ…å« `"context.test"`

---

## 9. æµ‹è¯•å¥—ä»¶

### 9.1 æµ‹è¯•æ¶æ„

```
Server (Linda/OpenClaw)
  â”‚
  â”œâ”€â”€ nodes invoke context.test  â”€â”€â†’  Susan (æ‰‹æœº App)
  â”‚                                       â”‚
  â”‚                                       â”œâ”€â”€ ContextEngineService.init()
  â”‚                                       â”œâ”€â”€ loadDefaultRules() + rebindGeofences()
  â”‚                                       â”œâ”€â”€ C++ nativeEvaluate(snapshot)
  â”‚                                       â”‚     â”œâ”€â”€ å†³ç­–æ ‘è·¯ç”±
  â”‚                                       â”‚     â”œâ”€â”€ è½¯åŒ¹é…ï¼ˆin/eq/lte/gte/range/neqï¼‰
  â”‚                                       â”‚     â””â”€â”€ Cooldown + Rate Limit æ£€æŸ¥
  â”‚                                       â”‚
  â”‚  â†â”€â”€ è¿”å› { matches, ruleCount } â”€â”€â”€â”€â”˜
  â”‚
  â””â”€â”€ éªŒè¯ matches vs é¢„æœŸ
```

### 9.2 æµ‹è¯•åœºæ™¯æ¸…å•

#### è§„åˆ™å®Œæ•´è¦†ç›–ï¼ˆ11/11 è§„åˆ™ï¼‰

| # | åœºæ™¯ | å…³é”®æ¡ä»¶ | é¢„æœŸè§„åˆ™ | ç»“æœ |
|---|------|---------|---------|------|
| 1 | ä½ç”µé‡é€šå‹¤ | morning + walking + battery=10 + !charging | rule_low_battery(100%) + rule_morning_workday(100%) | âœ… |
| 2 | å·¥ä½œæ—¥ driving é€šå‹¤ | morning + driving + !weekend | rule_morning_workday(100%) + rule_commuting(100%) | âœ… |
| 3 | åˆ°è¾¾å…¬å¸ | morning + stationary + geofence=work | rule_arrive_work(100%) | âœ… |
| 4 | å‘¨æœ«æ—©ä¸Šåœ¨å®¶ | morning + weekend + stationary | rule_weekend_morning(100%) + rule_long_stationary(100%) | âœ… |
| 5 | æ·±å¤œé™æ­¢ | night + hour=23 + stationary | rule_bedtime(100%) | âœ… |
| 6 | å‚æ™šä¸‹ç­å¼€è½¦ | evening + driving + !weekend | rule_commuting(100%) | âœ… |
| 7 | æ™šä¸Šåˆ°å®¶ | evening + stationary + geofence=home | rule_evening_home(100%) | âœ… |
| 8 | åé¢-ä¸‹åˆé™æ­¢æ— å›´æ  | afternoon + stationary + battery=60 | ä»… rule_long_stationary(100%) | âœ… |
| 9 | åˆ°è¾¾å¥èº«æˆ¿ | evening + stationary + geofence=gym | rule_arrive_gym(100%) | âœ… |
| 10 | æ—©ä¸Šç¦»å®¶ï¼ˆå®Œæ•´åŒ¹é…ï¼‰| morning + walking + geofenceâ‰ home | rule_leave_home_morning(100%) | âœ… |
| 11 | ä¸‹ç­ç¦»å¼€å…¬å¸ | evening + walking + geofenceâ‰ work | rule_leave_work(100%) | âœ… |

#### è¾¹ç•Œå€¼æµ‹è¯•

| # | åœºæ™¯ | å…³é”®æ¡ä»¶ | é¢„æœŸ | ç»“æœ |
|---|------|---------|------|------|
| 12 | ç”µé‡æ°å¥½ 15% | batteryLevel=15 + !charging | rule_low_battery(100%) | âœ… |
| 13 | ç”µé‡ 16%ï¼ˆsoft decayï¼‰| batteryLevel=16 + !charging | rule_low_battery(33%) è¡°å‡ | âœ… |
| 14 | å……ç”µä¸­ä½ç”µé‡ | batteryLevel=10 + charging | ä¸è§¦å‘ rule_low_battery | âœ… |
| 17 | hour=22 è¾¹ç•Œ | hour=22 + stationary | rule_bedtime(100%) | âœ… |
| 18 | hour=21 è¡°å‡ | hour=21 + stationary | rule_bedtime(55%) soft decay | âœ… |

#### è¿åŠ¨çŠ¶æ€è¦†ç›–

| # | åœºæ™¯ | motionState | éªŒè¯ | ç»“æœ |
|---|------|------------|------|------|
| 1 | æ­¥è¡Œé€šå‹¤ | walking | rule_morning_workday âœ“ | âœ… |
| 2 | é©¾è½¦é€šå‹¤ | driving | rule_commuting âœ“ | âœ… |
| 15 | è·‘æ­¥ | running | ä¸è¯¯è§¦é€šå‹¤ç±» | âœ… |
| 16 | å…¬äº¤ | transit | rule_commuting âœ“ | âœ… |
| 20 | éª‘è¡Œ | cycling | ä¸è¯¯è§¦é€šå‹¤ç±» | âœ… |
| 4 | é™æ­¢ | stationary | rule_long_stationary âœ“ | âœ… |

#### ç½‘ç»œçŠ¶æ€è¦†ç›–

| # | åœºæ™¯ | networkType | ç»“æœ |
|---|------|-----------|------|
| å¤šä¸ª | WiFi | wifi | âœ… |
| å¤šä¸ª | èœ‚çª | cellular | âœ… |
| 19 | æ— ç½‘ç»œ | none | âœ… æ— å¼‚å¸¸è§¦å‘ |

#### è´Ÿé¢æµ‹è¯•

| # | åœºæ™¯ | éªŒè¯ | ç»“æœ |
|---|------|------|------|
| 8 | ä¸‹åˆé™æ­¢æ— å›´æ  | ä¸è§¦å‘é€šå‹¤/å‡ºé—¨ç±»è§„åˆ™ | âœ… |
| 14 | å……ç”µä¸­ä½ç”µé‡ | ä¸è§¦å‘ä½ç”µé‡æé†’ | âœ… |
| 15 | running å‘¨æœ« | ä¸è¯¯è§¦é€šå‹¤ | âœ… |
| 20 | cycling å‘¨æœ« | ä¸è¯¯è§¦é€šå‹¤ | âœ… |
| 21 | åœ¨å®¶å›´æ å†…+æ—©ä¸Š | ä¸è§¦å‘ leave_home | âœ… |

### 9.3 æµ‹è¯•ç»“æœ

- **æ€»åœºæ™¯æ•°ï¼š** 21
- **é€šè¿‡ï¼š** 21/21 (100%)
- **è§„åˆ™è¦†ç›–ï¼š** 11/11 (100%)
- **è¿åŠ¨çŠ¶æ€è¦†ç›–ï¼š** 6/6 (stationary/walking/running/cycling/driving/transit)
- **ç½‘ç»œç±»å‹è¦†ç›–ï¼š** 3/3 (wifi/cellular/none)
- **å›´æ ç±»åˆ«è¦†ç›–ï¼š** 3/6 (home/work/gym)ï¼Œtransit/shopping/restaurant æ— å†…ç½®è§„åˆ™ï¼ˆèµ° ContextAwarenessService é»˜è®¤æ¨èé€»è¾‘ï¼Œä¸ç»è¿‡ C++ å¼•æ“ï¼‰

### 9.4 å·²å‘ç°å¹¶ä¿®å¤çš„é—®é¢˜

| é—®é¢˜ | åŸå›  | ä¿®å¤ |
|------|------|------|
| è¿ç»­æµ‹è¯•åŒä¸€è§„åˆ™ä¸è§¦å‘ | loadRules ä¸æ¸…ç©º lastFired_ cooldown map | loadRules æ—¶æ¸…ç©ºæ‰€æœ‰ cooldown è®¡æ—¶å™¨ |
| context_engine.so åŠ è½½å¤±è´¥ | CMakeLists.txt é—æ¼ add_subdirectory | æ·»åŠ  context_engine åˆ°æ ¹ CMakeLists |
| ImportLinUCB ç¼–è¯‘é”™è¯¯ | å‡½æ•°ç¼ºå°‘ return + é—­åˆæ‹¬å· | æ·»åŠ  `return nullptr;` å’Œ `}` |

---

*æ–‡æ¡£å®Œ*
